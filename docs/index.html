<!doctype html>
<html lang="ja">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>IB‑Link ユーザーマニュアル</title>
	<link rel="preconnect" href="https://cdn.jsdelivr.net">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.9.0/styles/github.min.css">
<style>
		:root{
			--accent:#0ea5e9;
			--accent-600:#0284c7;
			--bg:#ffffff;
			--sidebar-bg:#f8fafc;
			--border:#e5e7eb;
			--text:#0f172a;
			--muted:#475569;
		}
		html{scroll-behavior:smooth}
		body{
			margin:0;
			background:var(--bg);
			color:var(--text);
			font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", "Hiragino Kaku Gothic ProN", "Noto Sans JP", Meiryo, system-ui, sans-serif;
			line-height:1.6;
		}
		/* Sidebar TOC */
		.toc{
			position:fixed;
			top:0;left:0;bottom:0;
			width:280px;
			background:var(--sidebar-bg);
			border-right:1px solid var(--border);
			overflow:auto;
			padding:16px 12px 24px 16px;
		}
		.toc .brand{
			display:flex;align-items:center;gap:8px;
			font-weight:600;font-size:14px;color:var(--muted);
			padding:8px 4px 12px 4px;letter-spacing:.02em;
		}
		.toc .title{
			font-size:12px;font-weight:700;color:var(--muted);
			text-transform:uppercase;letter-spacing:.08em;margin:8px 0 6px 2px;
		}
		.toc ul{list-style:none;margin:0;padding:0 6px 24px 2px}
		.toc li{margin:2px 0}
		.toc a{
			display:block;padding:6px 8px;border-radius:6px;text-decoration:none;
			color:var(--text);font-size:13px;
		}
		.toc a:hover{background:#e6f6fe;color:var(--accent-600)}
		.toc a.active{background:#dff2fd;color:var(--accent-600);font-weight:600}
		.toc .lvl3{padding-left:12px}
		/* Content */
		.container{
			margin-left:300px;
			max-width:980px;
			padding:32px 24px;
		}
		.container h1{font-size:28px;line-height:1.2;margin:8px 0 20px}
		.container h2{margin-top:28px;padding-top:4px;border-top:1px solid var(--border)}
		.container h3{margin-top:20px}
		.container a{color:var(--accent-600);text-decoration:underline;text-underline-offset:2px}
		pre{border:1px solid var(--border);border-radius:8px;box-shadow:0 1px 2px rgba(0,0,0,.04);padding:16px;overflow:auto}
		code{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
		img{max-width:100%;height:auto}
		/* Back to top */
		.back-to-top{
			position:fixed;right:18px;bottom:18px;background:var(--accent);color:#fff;
			border:none;border-radius:999px;padding:10px 12px;font-size:12px;cursor:pointer;
			box-shadow:0 8px 24px rgba(2,132,199,.25);opacity:0;pointer-events:none;transition:opacity .2s ease, transform .2s ease;
		}
		.back-to-top.show{opacity:1;pointer-events:auto;transform:translateY(0)}
		/* Responsive */
		@media (max-width:1024px){
			.toc{display:none}
			.container{margin-left:0;padding:20px 16px}
		}
</style>
	<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.9.0/highlight.min.js"></script>
</head>
<body>
	<nav class="toc">
		<div class="brand">IB‑Link ユーザーガイド</div>
		<div class="title">目次</div>
		<ul id="toc"></ul>
	</nav>
	<main id="app" class="container">
		<p>読み込み中…</p>
	</main>
	<button id="toTop" class="back-to-top" aria-label="Back to top">Top</button>
  <script>
		// Fetch and render Markdown
		const app = document.getElementById('app');
		const tocRoot = document.getElementById('toc');
		function slugify(s){
			return (s||'').toLowerCase()
				.replace(/[^a-z0-9\u3040-\u30ff\u4e00-\u9faf\s-]/g,'')
				.replace(/\s+/g,'-')
				.replace(/-+/g,'-')
				.substring(0,80);
		}
		function ensureHeadingIds(container){
			const hs = container.querySelectorAll('h2, h3');
			hs.forEach(h=>{
				if(!h.id){
					h.id = slugify(h.textContent.trim()) || ('sec-' + Math.random().toString(36).slice(2,8));
				}
			});
			return hs;
		}
		function buildToc(headings){
			tocRoot.innerHTML = '';
			headings.forEach(h=>{
				const li = document.createElement('li');
				if(h.tagName.toLowerCase()==='h3') li.className = 'lvl3';
				const a = document.createElement('a');
				a.href = '#' + h.id;
				a.textContent = h.textContent.replace(/\s+/g,' ').trim();
				li.appendChild(a);
				tocRoot.appendChild(li);
			});
			// Active highlight
			const links = tocRoot.querySelectorAll('a');
			const map = {};
			links.forEach(a=>{ map[a.getAttribute('href').slice(1)] = a; });
			const io = new IntersectionObserver(entries=>{
				entries.forEach(e=>{
					if(e.isIntersecting){
						const id = e.target.id;
						links.forEach(a=>a.classList.remove('active'));
						if(map[id]) map[id].classList.add('active');
					}
				});
			},{rootMargin:'0px 0px -70% 0px', threshold:0});
			headings.forEach(h=>io.observe(h));
		}
		async function render(){
			try{
				const res = await fetch('./index.md', {cache:'no-cache'});
				if(!res.ok) throw new Error('Failed to load index.md');
				const md = await res.text();
				// Render with marked
				marked.setOptions({
					highlight: function(code, lang){
						try{ return hljs.highlight(code, {language: lang || 'plaintext'}).value; }
						catch(_){ return hljs.highlightAuto(code).value; }
					},
					breaks: false,
					gfm: true
				});
				app.innerHTML = marked.parse(md);
				// Code blocks styling
				document.querySelectorAll('pre code').forEach(el=>hljs.highlightElement(el));
				// Build TOC
				const headings = ensureHeadingIds(app);
				buildToc(headings);
			}catch(e){
				app.innerHTML = '<p>Markdown の読み込みに失敗しました。ネットワークとパスを確認してください。</p>';
				console.error(e);
			}
		}
		render();
		// Back to top
		const toTop = document.getElementById('toTop');
		toTop.addEventListener('click', ()=>window.scrollTo({top:0, behavior:'smooth'}));
		window.addEventListener('scroll', ()=>{
			if(window.scrollY>600) toTop.classList.add('show');
			else toTop.classList.remove('show');
		});
	</script>
</body>
</html>


